<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- OpenGraph Tags -->

  <!-- Title Tags -->
  <title>Shape the story</title>
  <meta property="og:title" content="LinkedIn: Log In or Sign Up">
  <meta name="twitter:title" content="LinkedIn: Log In or Sign Up">

  <!-- Description Tags -->
  <meta name="description" content="">
  <meta property="og:description" content="750 million+ members | Manage your professional identity. Build and engage with your professional network. Access knowledge, insights and opportunities.">
  <meta name="twitter:description" content="750 million+ members | Manage your professional identity. Build and engage with your professional network. Access knowledge, insights and opportunities.">


  <!-- URL Tags -->
  <meta property="og:url" content="https://linkedin.com">
  <meta property="twitter:url" content="https://linkedin.com">
  <meta property="twitter:domain" content="linkedin.com">

  <!-- Image Tags -->
  <meta property="og:image" content="https://static.licdn.com/scds/common/u/images/logos/favicons/v1/favicon.ico">
  <meta name="twitter:image" content="https://static.licdn.com/scds/common/u/images/logos/favicons/v1/favicon.ico">

    <!-- Other Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
    
  <!-- END OPENGRAPH TAGS -->



  <link rel="stylesheet" href="https://unpkg.com/missing.css@1.0.9/dist/missing.min.css">
  <link rel="stylesheet" href="/styles.css">
<script src="https://unpkg.com/htmx.org@1.8.6"></script>
<script src="https://unpkg.com/hyperscript.org@0.9.7"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.8/index.global.min.js'></script> -->
<!-- <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/icalendar@6.1.8/index.global.min.js'></script> -->
</head>
<body>
  <main id="initial">
    <h1>A cooperatively built social community, to build our worlds and movements.</h1>
      <div>
      <form class="" style="" hx-post="/.netlify/functions/signUp" hx-trigger="submit" _="on htmx:afterSwap call createProjectResponseHandler(event)">

        <fieldset class="visually-hidden" aria-hidden="true">
          <label for="last-name-subscribe-field">Last Name:</label>
          <input
            type="text"
            id="last-name-subscribe-field"
            name="last_name"
            autocomplete="off"
            tabindex="-1"
          />
        </fieldset>

        <div style="display: flex; gap: 20px; margin: auto; width: fit-content;">

            <div style="margin: auto">
              <label for="email"><strong>Email</strong></label>
              <input type="email" id="email" name="email" style="width: 250px; max-width: 100%;" required>
              </div>
              
              <!-- <div style="">
                <div style="display: inline-block; margin-right: 10px;">
                <label for="postal_code"><strong>Postal code</strong></label>
                <input type="number" id="postal_code" name="postal_code" style="width: 100px; max-width: 100%;">
                </div>

                <div style="display: inline-block;">
                <label for="country"><strong>Country</strong></label>
                <input type="text" id="country" name="country" style="width: 50px; max-width: 100%;">
                </div>
              <p style="display: block;"><em>Optional (If you want to connect with others in your area).</em></p>
              </div>
          </div> -->

          <div>
            <p><em>Select your general location<br>to help us organize</em></p>
          <div id="map"></div>
          <p>Coordinates: { <span id="coordinates">21.41727, -37.44140</span> }</p>
          <fieldset class="visually-hidden" aria-hidden="true">
            <label for="latlng">latlng</label>
            <input
              id="latlng"
              name="latlng"
              autocomplete="off"
              tabindex="-1"
              value="{&quot;lat&quot;: 21.41727, &quot;lng&quot;: -37.44140}"
            />
          </fieldset>
          </div>
        </div>

        <script>
          
          var map = L.map('map').setView([30.505, -15], 1);
          L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png?{foo}', {foo: 'bar', attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);

          var popup = L.popup();
          var marker = L.marker([21.417, -37.441]).addTo(map);


          function onMapClick(e) {

            console.log(e);
            console.log(e.latlng);

              marker
                  .setLatLng(e.latlng)
                  .addTo(map);

              if (map.getZoom() < 6) {

              map
                .setView(e.latlng, 6);

              }

              document.getElementById('coordinates').innerText = `${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
              document.getElementById('latlng').value = `{ "lat": ${e.latlng.lat.toFixed(5)}, "lng": ${e.latlng.lng.toFixed(5)} }`;
          }

          map.on('click', onMapClick);
        </script>

          <br>
          <br>
            <button type="submit" style="font-size: 24px; cursor: pointer;">Join Coop</button>
        </form>
        </main>
        <section id="success">
        </section>
</body>

<script type="text/javascript">
        function createProjectResponseHandler(event) {
            console.log(event);
            const xhr = event.detail.xhr;

            history.replaceState("", "", "success.html");



            // const response = JSON.parse(xhr.responseText);
            // console.log(response);

            if (xhr.status === 200) {
                // const responseContainer = document.getElementById('response-container');
                // responseContainer.innerHTML = `<p>Email successfully submitted!  You're in!  Stay tuned for more info!`;
                
                  // window.location.href="/success"

                    // setTimeout(function() {
                    //     const url = new URL(window.location.origin);
                    // url.pathname = '/project';
                    // url.searchParams.set('project_id', response.id);
                    // window.location.href = url.href;
                    // }, 1000);

                    // setTimeout(function() {
                    //     window.location
                    //     window.location.href(`${window.location}project?project_id=${response.id}`)
                    // }, 1000)
            } else {
                const responseContainer = document.getElementById('response-container');
                responseContainer.innerHTML = `<p>Submission error.  Please refresh and try again, or DM on Twitter.</p>`;
            }
        }
  </script>
</html>