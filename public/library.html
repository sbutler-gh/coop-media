<html>
<head>
    <style>
        /* table {
          font-family: Arial, Helvetica, sans-serif;
          border-collapse: collapse;
          width: 100%;
        }
        
        table td, table th {
          border: 1px solid #ddd;
          padding: 8px;
        }
        table tr:nth-child(even){background-color: #f2f2f2;}
        table tr:hover {background-color: #ddd;}
        
        table th {
          padding-top: 12px;
          padding-bottom: 12px;
          text-align: left;
          background-color: #ff7b00;
          color: white;
        } */
        .visually-hidden {
position: absolute;
left: -9999px;
}

input {
display: block;
margin: auto;
}

body {
  background: black;
  color: lightgrey !important;
  text-decoration: none !important;
  font-family: arial;
  padding: 1em;
}

a {
    color: lightgrey;
}

a.title {
  text-decoration: none;
  color: lightgrey;
  font-style: italic;
  font-size: 16px;
  font-weight: 600;
  display: block;
}

.credit {
  font-size: 12px;
}

#featured img.thumbnail {
max-width: 450px;
}

.carousel img.thumbnail {
  width: 200px;
  height: 200px;
  object-fit: contain;
}

.carousel iframe {
  display: none;
}

.carousel {
  display: flex;
  max-width: 100%;
  overflow-x: scroll;
}

.carousel > div {
  display: block;
  margin-right: 1em;
}

.title > img:hover {
  opacity: 0.75;
  cursor: pointer;
}

.m {
  position: relative;
}

/* This is code for if we want to add an icon on top of media entry items when hovering.  This UX is more suitable for if we have an iframe centric approach. */

/* .title:hover::after {
    content: 'â–º';
    position: absolute;
    top: 25%;
    left: 50%;
    font-size: 40px;
    color: #787878;
    background: white;
    border-radius: 13px;
    transform: translate(-50%, 0);
} */

        </style>
          <script src="https://unpkg.com/htmx.org@1.8.6"></script>
</head>
<body>
  <nav style="display: flex; gap: 200px;">
    <h1>stream</h1>
  
    <!-- <a href="/events" style="font-size: 20px; text-decoration: none;">events</a> -->
    </nav>
    <!-- <h1>stream</h1> -->
  
    <br>
  
    <section class="" style="display: flex;">
  
    <div id="featured" style="max-width: 450px">
    </div>
  
    <div class="about" style="width: 100%; margin: auto; margin-top: 0; text-align: center;">
      <h2>A people's library.</h2>
      <p>Curated and generated by the people who use it.</p>
      <p>To tell our stories, and make our worlds.</p>
      <p><em><strong>Want to get involved in the library or subscribe for updates?</strong></em></p>
      <form class="" style="" hx-post="/.netlify/functions/signUp" hx-trigger="submit" _="">

        <fieldset class="visually-hidden" aria-hidden="true">
          <label for="last-name-subscribe-field">Last Name:</label>
          <input
            type="text"
            id="last-name-subscribe-field"
            name="last_name"
            autocomplete="off"
            tabindex="-1"
          />
          <input type="text" name="project" value="library" autocomplete="off" tabindex="-1">
        </fieldset>

        <div style="display: flex; margin: auto; width: fit-content">
          <div style="margin-right: 20px;">
              <label for="email"><strong>Email*</strong></label>
              <input type="email" id="email" name="email" style="width: 250px; max-width: 100%;" required>
            </div>
          <div>
            <p><strong>How would you like to get involved? (Optional)</strong></p>
            <textarea style="width: 250px; max-width: 100%;" name="notes"></textarea>
          </div>
        </div>

        <br>
      <!-- <div style="display: flex; margin: auto; width: 300px;"><input type="checkbox"><p style="">Are you an artist or industry worker? ?&#x20DD;</p></div> -->
      <button type="submit">Submit</button>
      </form>
  
    </div>
  
  </section>
  
    <br>
    <h2>Explore</h2>
    <br>
    <!-- <h1 style="text-align: center;">User Data</h1> -->
    <div id="carousel" class="carousel">

    </div>

    <!-- The viewer-bg and viewer-iframe are potential features in development, so instead of opening a new tab when you click a resource, it loads an iframe in the page.  If you want to try this out, you can simply uncomment these elements and uncomment the evnet listener functions in the script below in the page. -->
    <!-- <div id="viewer-bg" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; background: black; opacity: 90%;">
    </div>
    <iframe id="viewer-iframe" style="display: none; width: 80vw; height: auto; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 600px; max-width: 100%; height: 400px; z-index: 3;" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe> -->
  
    <script>
      const sheetId = '1oaA7dLz8Scv3mH42Jq_jjfDLvKk4D3umrCArQomqMCE';
const base = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?`;
const sheetName = 'Sync';
const query = encodeURIComponent('Select *')
const url = `${base}&sheet=${sheetName}&tq=${query}`
const data = []
document.addEventListener('DOMContentLoaded', init)
const output = document.querySelector('.output')
function init() {
    fetch(url)
        .then(res => res.text())
        .then(rep => {
            //Remove additional text and extract only JSON:
            const jsonData = JSON.parse(rep.substring(47).slice(0, -2));
            console.log(rep)
            console.log(jsonData);
            const colz = [];
            const tr = document.createElement('tr');
            // //Extract column labels
            // jsonData.table.cols.forEach((heading) => {
            //     if (heading.label) {
            //         let column = heading.label;
            //         colz.push(column);
            //         const th = document.createElement('th');
            //         th.innerText = column;
            //         tr.appendChild(th);
            //     }
            // })
            // output.appendChild(tr);
            // //extract row data:
            // jsonData.table.rows.forEach((rowData) => {
            //     const row = {};
            //     colz.forEach((ele, ind) => {
            //         row[ele] = (rowData.c[ind] != null) ? rowData.c[ind].v : '';
            //     })
            //     data.push(row);
            // })
            // processRows(data);
            jsonData.table.rows.forEach((row) => {

              if(row.c[8]?.v >= 1) {

                console.log(row)

                let carousel = document.getElementById('carousel');

                let media = document.createElement('div');

                let url = row.c[3]?.v;
                let title = row.c[1]?.v;
                let thumbnail = "/thumbnail/" + row.c[9]?.v + ".jpg";
                let creator = row.c[2]?.v;
                let format = row.c[4]?.v;


                media.classList = `m ${format}`;
                media.src = url;
                
                media.innerHTML = `
                <a class="title" href=${url} target="_blank"><img class="thumbnail" src=${thumbnail} loading="lazy"><br>${title}</a>
                <p>${creator}</p>`

                if (row.c[8]?.v == 1) {
                  document.getElementById('carousel').appendChild(media)
                }

                else {
                  document.getElementById('featured').appendChild(media);
                }

                // T
                // This code is for the iframe feature that's in development.  Simply uncomment this addEventListener and the one at the end of the script to reactivate this feature for development purposes.

                //   media.addEventListener('click', function handleClick(event) {
                //   console.log('open modal', event);

                //   document.getElementById('viewer-bg').style.display = "block";
                //   document.getElementById('viewer-iframe').style.display = "block";

                //   document.getElementById('viewer-iframe').src = event.target.href;
                // });


              }

            })

                console.log(document.getElementById('carousel'));
                
                // document.getElementById('viewer-bg').addEventListener('click', function handleClick(event) {
                // document.getElementById('viewer-bg').style.display = "none";
                // document.getElementById('viewer-iframe').style.display = "none";

                // });
        })
}

    </script>

</body>
</html>